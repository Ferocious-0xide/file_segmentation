<!DOCTYPE html>
<html lang="en">
<!-- ... (keep existing head and form sections the same) ... -->

<div id="result" class="mt-8 hidden">
    <h2 class="text-xl font-semibold mb-4">Results</h2>
    <div id="resultOverview" class="mb-6 bg-blue-50 p-4 rounded-lg">
        <!-- Overview will be inserted here -->
    </div>
    <div id="segmentGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Segments will be inserted here -->
    </div>
</div>

<!-- Update the script section to handle formatted display -->
<script>
    // ... (keep existing form handling code) ...

    function formatNumber(num) {
        return num.toLocaleString();
    }

    function displayResults(result) {
        const resultDiv = document.getElementById('result');
        const overviewDiv = document.getElementById('resultOverview');
        const segmentGrid = document.getElementById('segmentGrid');

        // Display overview
        overviewDiv.innerHTML = `
            <div class="flex flex-col space-y-2">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Process ID:</span>
                    <span class="font-mono">${result.process_uuid}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Total Records:</span>
                    <span class="font-semibold">${formatNumber(result.total_records)}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">Number of Segments:</span>
                    <span class="font-semibold">${result.segments.length}</span>
                </div>
            </div>
        `;

        // Display segments
        segmentGrid.innerHTML = result.segments.map(segment => `
            <div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition-shadow">
                <div class="border-b pb-2 mb-2">
                    <span class="text-sm font-medium text-gray-500">Segment ${segment.segment_number + 1}</span>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Records:</span>
                        <span class="font-semibold">${formatNumber(segment.record_count)}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Percentage:</span>
                        <span class="font-semibold">
                            ${((segment.record_count / result.total_records) * 100).toFixed(1)}%
                        </span>
                    </div>
                    <div class="mt-2 pt-2 border-t">
                        <span class="text-xs text-gray-500 font-mono break-all">${segment.segment_uuid}</span>
                    </div>
                </div>
            </div>
        `).join('');

        resultDiv.classList.remove('hidden');
    }

    // Update the form submission to use the new display function
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('file', document.getElementById('file').files[0]);
        
        // Get segmentation method and settings
        const method = document.querySelector('input[name="segmentMethod"]:checked').value;
        
        if (method === 'equal') {
            formData.append('num_segments', document.getElementById('segments').value);
            formData.append('segmentation_method', 'equal');
        } else {
            formData.append('segment_column', document.getElementById('segmentColumn').value);
            formData.append('segmentation_method', 'column');
        }
        
        // Get selected columns
        const selectedColumns = Array.from(document.querySelectorAll('input[name="selectedColumns"]:checked'))
            .map(input => input.value);
        formData.append('selected_columns', JSON.stringify(selectedColumns));
        
        try {
            const response = await fetch('/process', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            displayResults(result);
            
        } catch (error) {
            console.error('Error:', error);
            alert('Error processing file');
        }
    });
</script>
</body>
</html>